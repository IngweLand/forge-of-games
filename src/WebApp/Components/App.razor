@using System.Globalization
@using Ingweland.Fog.Application.Core.Constants
@using Ingweland.Fog.WebApp.Client.Components
@inject IWebHostEnvironment Environment

<!DOCTYPE html>
<html lang="@CultureInfo.CurrentUICulture.TwoLetterISOLanguageName">

<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    @if (Environment.IsDevelopment() || Environment.IsStaging())
    {
        <meta name="robots" content="noindex, nofollow">
    }
    @if (!(Environment.IsDevelopment() || Environment.IsStaging()))
    {
        <!-- Google Tag Manager -->
        <script>(function (w, d, s, l, i) {
                w[l] = w[l] || [];
                w[l].push({
                    'gtm.start':
                        new Date().getTime(), event: 'gtm.js'
                });
                var f = d.getElementsByTagName(s)[0],
                    j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
                j.async = true;
                j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
                f.parentNode.insertBefore(j, f);
            })(window, document, 'script', 'dataLayer', 'GTM-W49685VB');</script>
        <!-- End Google Tag Manager -->

        <script async
                src="@($"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={FogConstants.AD_SENSE_PUBLISHER_ID}")"
                crossorigin="anonymous"></script>
    }
    else if (Environment.IsStaging())
    {
        <!-- Start cookieyes banner -->
        <script id="cookieyes" type="text/javascript"
                src="https://cdn-cookieyes.com/client_data/f18e79c0fc78ed00972be31e/script.js"></script>
        <!-- End cookieyes banner -->

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-PSQGSHXL17"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }

            gtag('js', new Date());

            gtag('config', 'G-PSQGSHXL17', {
                'debug_mode': true
            });
        </script>
    }
    <base href="/"/>
    <script src="@Assets["scripts/locale-management.js"]"></script>
    <script src="@Assets["scripts/forgeofgames.js"]"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Noto+Sans+JP:wght@100..900&family=Noto+Sans+TC:wght@100..900&family=Noto+Sans:ital,wdth,wght@0,62.5..100,100..900;1,62.5..100,100..900&display=swap"
        rel="stylesheet">
    <link href="@Assets["_content/MudBlazor/MudBlazor.min.css"]" rel="stylesheet"/>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"/>
    <link href="@Assets["app.css"]" rel="stylesheet"/>
    <link href="@Assets["Ingweland.Fog.WebApp.styles.css"]" rel="stylesheet"/>
    <ImportMap/>
    <link rel="icon" type="image/png" sizes="16x16" href="@Assets["images/favicons/icon16.png"]">
    <link rel="icon" type="image/png" sizes="32x32" href="@Assets["images/favicons/icon32.png"]">
    <link rel="icon" type="image/png" sizes="48x48" href="@Assets["images/favicons/icon48.png"]">
    <link rel="icon" type="image/png" sizes="128x128" href="@Assets["images/favicons/icon128.png"]">
    <HeadOutlet @rendermode="InteractiveWebAssembly"/>
    <PageTitle>Forge of Games - Your Ultimate Guide to Heroes of History</PageTitle>
</head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W49685VB"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
<Routes @rendermode="InteractiveWebAssembly"/>
<script src="@Assets["_content/Syncfusion.Blazor.Core/scripts/syncfusion-blazor.min.js"]"
        type="text/javascript"></script>
<script src="_framework/blazor.web.js"></script>
<script src="@Assets["_content/MudBlazor/MudBlazor.min.js"]"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function isPrivacyElement(el) {
        return (
            el.nodeType === Node.ELEMENT_NODE &&
            el.tagName === 'DIV' &&
            !el.id &&
            el.classList.length === 0 &&
            el.shadowRoot !== null
        );
    }

    function removePrivacyElement(elements) {
        for (let i = 0; i < elements.length; i++) {
            const el = elements[i];

            if (isPrivacyElement(el)) {
                el.remove();
                console.debug("Removed Google Privacy Settings button/banner")
                return true;
            }
        }

        return false;
    }

    const observer = new MutationObserver((mutations) => {
        console.debug("Trying to remove Google Privacy Settings button/banner");
        for (const mutation of mutations) {
            if (removePrivacyElement(mutation.addedNodes)) {
                return;
            }
        }
    });

    observer.observe(document.body, {
        childList: true
    });

    removePrivacyElement(document.body.children);
</script>

</body>

</html>
