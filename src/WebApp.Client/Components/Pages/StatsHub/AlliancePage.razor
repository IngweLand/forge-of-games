@attribute [Route(FogUrlBuilder.PageRoutes.ALLIANCE_TEMPLATE)]
@using Ingweland.Fog.Application.Client.Web.Localization
@using Ingweland.Fog.Application.Core.Helpers
@using Ingweland.Fog.WebApp.Client.Components.Elements.StatsHub
@using Size = MudBlazor.Size
@using ValueType = Syncfusion.Blazor.Charts.ValueType
@inherits StatsHubPageBase
@if (IsInitialized && _alliance != null)
{
    <div class="page-container">
        <div class="fog-container info-container">
            <div class="avatar-container">
                <div class="avatar">
                    <img class="avatar-background" src="@_alliance.Alliance.AvatarBackgroundUrl"/>
                    <img class="avatar-icon" src="@_alliance.Alliance.AvatarIconUrl"/>
                </div>
                @if (_alliance.Alliance.IsDeleted)
                {
                    <span class="deleted-label">@Loc[FogResource.Common_Deleted]</span>
                }
            </div>
            <div class="details">
                <div>
                    <span class="label">@Loc[FogResource.StatsHub_NameSearchField_Label]: </span>
                    "@_alliance.Alliance.Name"
                </div>
                @if (_alliance.Alliance.RankingPoints > 0)
                {
                    <div>
                        <span class="label">@Loc[FogResource.StatsHub_Player_RankingPoints]: </span>
                        @_alliance.Alliance.RankingPoints
                    </div>
                }
                @if (_alliance.Alliance.Rank > 0)
                {
                    <div>
                        <span class="label">@Loc[FogResource.StatsHub_Player_Rank]: </span>
                        @_alliance.Alliance.Rank
                    </div>
                }
                @if (_alliance.RegisteredAt != null)
                {
                    <div>
                        <span class="label">@Loc[FogResource.StatsHub_Alliance_RegisteredOn_Label]: </span>
                        @_alliance.RegisteredAt
                    </div>
                }
                <div>
                    <span class="label">@Loc[FogResource.StatsHub_Player_World]: </span>
                    @_alliance.Alliance.WorldId
                </div>
            </div>
        </div>

        @if (_alliance.CurrentMembers.Count > 0)
        {
            <div class="fog-container section-container">
                <span class="section-title">@Loc[FogResource.StatsHub_Alliance_CurrentMembers]</span>
                <div class="members-container">
                    @foreach (var member in _alliance.CurrentMembers)
                    {
                        <a class="anchor-inherited-style" href="@FogUrlBuilder.PageRoutes.Player(member.PlayerId)">
                            <AllianceMemberListItemComponent Member="@member"/>
                        </a>
                    }
                </div>
            </div>
        }

        @if (_canShowChart)
        {
            <div class="fog-container section-container ranking-points-chart-container">
                <div class="section-title expandable-section-title"
                     @onclick="ToggleRankingChart">
                    <span class="section-title">@Loc[FogResource.StatsHub_Player_RankingPoints]</span>
                    @if (_rankingChartIsExpanded)
                    {
                        <span class="material-symbols-outlined">collapse_all</span>
                    }
                    else
                    {
                        <span class="material-symbols-outlined">expand_all</span>
                    }
                </div>
                @if (_rankingChartIsExpanded)
                {
                    <SfChart Focusable="false" Height="300">
                        <ChartArea>
                            <ChartAreaBorder Width="0"/>
                        </ChartArea>
                        <ChartMargin Top="12"/>
                        <ChartPrimaryXAxis IntervalType="IntervalType.Days" Format="dd/MM"
                                           ValueType="ValueType.DateTime">
                            <ChartAxisMajorGridLines Color="var(--fog-border-color)" Width="1"/>
                            <ChartAxisLabelStyle FontFamily="var(--main-font-family)"
                                                 Color="var(--fog-text-color)"/>
                            <ChartAxisMajorTickLines Color="var(--fog-border-color)"/>
                            <ChartAxisLineStyle Color="var(--fog-border-color)" Width="2"/>
                        </ChartPrimaryXAxis>
                        <ChartPrimaryYAxis RangePadding="ChartRangePadding.Round">
                            <ChartAxisMajorGridLines Color="var(--fog-border-color)" Width="1"/>
                            <ChartAxisLabelStyle FontFamily="var(--main-font-family)"
                                                 Color="var(--fog-text-color)"/>
                            <ChartAxisMajorTickLines Color="var(--fog-border-color)"/>
                            <ChartAxisLineStyle Color="var(--fog-border-color)" Width="2"/>
                        </ChartPrimaryYAxis>
                        <ChartSeriesCollection>
                            <ChartSeries DataSource="@_alliance.RankingPoints" XName="Date" YName="Value"
                                         Type="ChartSeriesType.Line" Fill="var(--fog-chart-line-color)">
                                <ChartEmptyPointSettings Mode="EmptyPointMode.Drop"/>
                                <ChartSeriesAnimation Enable="false"/>
                            </ChartSeries>
                        </ChartSeriesCollection>
                    </SfChart>
                }
            </div>
        }

        <div class="fog-container section-container">
            <div class="section-title expandable-section-title"
                 @onclick="ToggleAthRankingsContainer">
                <span class="section-title">@Loc[FogResource.StatsHub_Alliance_AthRanking]</span>
                @if (_athRankingsContainerIsExpanded)
                {
                    <span class="material-symbols-outlined">collapse_all</span>
                }
                else
                {
                    <span class="material-symbols-outlined">expand_all</span>
                }
            </div>
            @if (_athRankingsContainerIsExpanded && _athRankings != null)
            {
                <div class="ath-ranking-items-container">
                    @foreach (var r in _athRankings)
                    {
                        <AthRankingComponent Ranking="@r"/>
                    }
                </div>
            }
        </div>

        <div class="fog-container section-container">
            <span class="section-title">@Loc[FogResource.StatsHub_Player_Names]</span>
            <MudTimeline TimelinePosition="TimelinePosition.Start">
                @foreach (var name in _alliance.Names)
                {
                    <MudTimelineItem Color="Color.Primary" Variant="Variant.Filled" Size="Size.Small">
                        <p class="preserve-whitespace">"@name.Value"</p>
                        <p class="timeline-date">@name.Date.ToString("d")</p>
                    </MudTimelineItem>
                }
            </MudTimeline>
        </div>

    </div>
}
else
{
    <LoadingIndicator/>
}
